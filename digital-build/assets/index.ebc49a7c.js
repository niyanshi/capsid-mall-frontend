import{b as ee}from"./explore.bf4a14db.js";import{I as te,a as se,b as ae,B as oe}from"./buy.1dfa4eb4.js";import{I as ne,B as re,F as le,a as ie,S as ce,b as de,_ as ue}from"./ballot.65869887.js";import{c as _e}from"./compass.33c07fc0.js";import{d as V}from"./dayjs.min.1ba1cbc9.js";import{d as A,u as U,a as O,o as f,c as x,b as e,t as v,e as t,g as R,v as L,_ as T,r as w,w as E,f as P,E as B,x as Y,F as z,h as K,i as F,y as H,z as J,A as S,B as pe,C as N,D as me,I as fe,j as I,m as ve,q as ye,s as ge}from"./index.21f0358c.js";import{u as G,h as Q,a as he,b as be,c as Re}from"./useSeaport.2a089d37.js";import{I as $e}from"./sort.d713bd9b.js";import{F as D,B as M}from"./index.430ca6ed.js";import{B as ke}from"./index.4361dfcf.js";import{B as Ie}from"./index.44c2e7ed.js";import{_ as qe}from"./gold.bdd5daf4.js";const we=""+new URL("folder.4e382557.png",import.meta.url).href,xe=""+new URL("file-add.c054ce75.png",import.meta.url).href,Ne=""+new URL("postbox.90e700c1.png",import.meta.url).href,Fe=""+new URL("thumbtack.3562c770.png",import.meta.url).href,Le=""+new URL("accept.ca9ce7df.png",import.meta.url).href,Se={class:"nfrs-display-item"},Be=["src"],Ce={class:"main-area"},Ve={class:"title"},Ae={class:"expire"},Ue=["src"],Te={class:"info"},De={class:"item"},Oe=["src"],Me={class:"item"},Pe=["src"],Ge=["src"],je=A({__name:"NFRsDisplayItem",props:{data:null,btn:null,isRequest:{type:Boolean}},setup(d){const s=d,{t:n}=U(),a=O(),y=()=>{if(s.isRequest){a.push(`/explore/nfr-details/${s.data.id}/request`);return}a.push(`/explore/nfr-details/${s.data.id}`)};return(r,l)=>(f(),x("div",Se,[e("img",{class:"image",src:s.data.avatar,alt:"",onClick:y},null,8,Be),e("div",Ce,[e("div",Ve,v(s.data.name),1),e("div",Ae,[e("img",{src:t(te),alt:""},null,8,Ue),R(" "+v(t(V)(s.data.expire).format("MM/DD/YYYY")+" "+t(n)("expires")),1)]),e("div",Te,[e("div",De,[e("img",{src:t(se),alt:""},null,8,Oe),R(" "+v(s.data.total+" "+t(n)("total")),1)]),e("div",Me,[e("img",{src:t(_e),alt:""},null,8,Pe),R(" "+v(s.data.price),1)])])]),s.btn&&Object.keys(s.btn).length!==0?(f(),x("div",{key:0,class:"btn",onClick:l[0]||(l[0]=$=>{var _,u;return(u=(_=s.btn)==null?void 0:_.event)==null?void 0:u.call(_,s.data)})},[R(v(s.btn.title)+" ",1),e("img",{src:s.btn.icon,alt:""},null,8,Ge)])):L("",!0)]))}});const W=T(je,[["__scopeId","data-v-62bd6709"]]);function Ee(d){return{all:d=d||new Map,on:function(s,n){var a=d.get(s);a?a.push(n):d.set(s,[n])},off:function(s,n){var a=d.get(s);a&&(n?a.splice(a.indexOf(n)>>>0,1):d.set(s,[]))},emit:function(s,n){var a=d.get(s);a&&a.slice().map(function(y){y(n)}),(a=d.get("*"))&&a.slice().map(function(y){y(s,n)})}}}const C=Ee(),Ye={class:"request-pannel"},ze={class:"title"},Ke=["src"],He={class:"item-display"},Je=A({__name:"RequestPannel",props:{data:null,isOwner:{type:Boolean}},setup(d){const s=d,{t:n}=U(),a=O();G();const y=999,r=w(1),l=w([]),$=async()=>{const{address:u,id:g}=a.currentRoute.value.params,p=await Q({nftTokenAddress:String(u),nftTokenId:String(g),type:"request",pageNum:r.value,pageSize:y});l.value=p.data.records.map(o=>{var m;return{id:o.id,avatar:(m=s.data)==null?void 0:m.avatar,total:o.amount,price:o.totalPrice,name:`${n("nfr")}: ${o.name||""}`,expire:V(o.createdAt).add(Number(o.duration),"day").valueOf(),order:o.order}})},_=async u=>{if(!(u!=null&&u.order))return;const{order:g,id:p}=u,o=await he(String(p));console.log({res:o})};return E(()=>s.data,()=>{var u;(u=s.data)!=null&&u.id&&$()},{immediate:!0}),P(()=>{C.on(B,()=>{$()})}),Y(()=>{C.off(B)}),(u,g)=>(f(),x("div",Ye,[e("div",ze,[e("img",{src:t(Fe),alt:""},null,8,Ke),R(" "+v(t(n)("requests")),1)]),e("div",He,[(f(!0),x(z,null,K(l.value,p=>(f(),F(W,{key:p.id,data:p,btn:s.isOwner?{title:t(n)("accept"),icon:t(Le),event:_}:{},"is-request":!0},null,8,["data","btn"]))),128))])]))}});const Qe=T(Je,[["__scopeId","data-v-f328b59e"]]),We=""+new URL("ticket.4bb62a6b.png",import.meta.url).href,Xe={class:"nfrs-pannel"},Ze={class:"title"},et=["src"],tt={class:"item-display"},st=["src"],at=A({__name:"NFRsPannel",props:{data:null,isOwner:{type:Boolean}},setup(d){const s=d,{t:n}=U(),a=O(),{buyNFR:y}=G(),r=H(),l=J(),$=4,_=w(1),u=w(0),g=w([]),p=async()=>{const{address:k,id:h}=a.currentRoute.value.params,i=await Q({nftTokenAddress:String(k),nftTokenId:String(h),type:"listing",pageNum:_.value,pageSize:$}),b=i.data.records.map(c=>{var q;return{id:c.id,avatar:(q=s.data)==null?void 0:q.avatar,total:c.amount,price:c.unitPrice,name:`${n("nfr")}: ${c.name||""}`,expire:V(c.createdAt).add(Number(c.duration),"day").valueOf(),order:c.orderOnChain}});u.value=i.data.total,g.value.push(...b)},o=async()=>{_.value=_.value+1,p()};E(()=>s.data,()=>{var k;(k=s.data)!=null&&k.id&&p()},{immediate:!0}),P(()=>{C.on(B,()=>{g.value=[],_.value=1,p()})}),Y(()=>{C.off(B)});const m=async k=>{l.setGlobalLoading(!0);try{if(!r.currentUser.isLogin){r.setLoginModalVisible(!0);return}if(!(k!=null&&k.order))return;const{order:h,id:i}=k,b=1,c=await be(String(i),b);if(c.code!==0)return;const q=c.data.nfrTrans.nfrTokenId;if(!await y({order:h,orderId:q,amount:b}))return;C.emit(B)}catch(h){console.error(h),S.error(h.message)}l.setGlobalLoading(!1)};return(k,h)=>(f(),x("div",Xe,[e("div",Ze,[e("img",{src:t(We),alt:""},null,8,et),R(" "+v(t(n)("nfrs")),1)]),e("div",tt,[(f(!0),x(z,null,K(g.value,i=>(f(),F(W,{key:i.id,data:i,btn:s.isOwner?{}:{title:t(n)("buy"),icon:t(ae),event:m}},null,8,["data","btn"]))),128))]),u.value>g.value.length?(f(),x("div",{key:0,class:"btn",onClick:o},[R(v(t(n)("more"))+" ",1),e("img",{src:t($e),alt:""},null,8,st)])):L("",!0)]))}});const ot=T(at,[["__scopeId","data-v-a145e85c"]]),nt={class:"request-nfr-modal"},rt={class:"layer one"},lt={class:"title"},it=["src"],ct={class:"close"},dt=["src"],ut={class:"layer content"},_t={class:"left"},pt={class:"form-layer one"},mt={class:"form-layer"},ft={class:"form-layer"},vt={class:"form-layer"},yt={class:"form-layer"},gt={class:"right"},ht={class:"name"},bt=["src"],Rt={class:"image"},$t=["src"],kt={class:"btn-group"},It=["src"],qt=["src"],wt=A({__name:"RequestNFRModal",props:{visible:{type:Boolean},data:null},emits:["close","request"],setup(d,{emit:s}){const n=d,{t:a}=U(),y=w(),r=pe({type:"",details:"",desc:"",quantity:"",price:""}),l=[{key:"0",value:"type"},{key:"1",value:"type1"},{key:"2",value:"type2"},{key:"3",value:"type3"}],$=p=>{for(let o=0;o<l.length;o++)if(l[o].value===p)return l[o].key;return""},_=()=>r.quantity?Number(r.quantity)>10?(S.error(a("warn-msg.high-quantity")),!1):r.type?r.desc?r.price?!0:(S.error(a("warn-msg.price")),!1):(S.error(a("warn-msg.desc")),!1):(S.error(a("warn-msg.type")),!1):(S.error(a("warn-msg.quantity")),!1),u=()=>{const p=V(),o=V(y.value.currentValue).endOf("d");if(!_())return;const m={type:Number($(r.type)),quantity:r.quantity||0,price:r.price||0,druation:Math.ceil(o.diff(p,"d",!0)),nftId:n.data.id,nftContractAddress:n.data.contractAddress,desc:r.desc};s("request",m)},g=()=>{s("close")};return(p,o)=>(f(),F(me,{visible:n.visible,top:156,onClose:g},{default:N(()=>[e("div",nt,[e("div",rt,[e("div",lt,[e("img",{src:t(ne),alt:""},null,8,it),R(" "+v(t(a)("request-nfr")),1)]),e("div",ct,[e("img",{src:t(fe),alt:"",onClick:g},null,8,dt)])]),e("div",ut,[e("div",_t,[e("div",pt,[I(D,{title:t(a)("create-nfr-form-items[1]")},{default:N(()=>[I(ke,{ref_key:"expireRef",ref:y},null,512)]),_:1},8,["title"]),I(D,{title:t(a)("create-nfr-form-items[2]")},{default:N(()=>[I(M,{modelValue:r.quantity,"onUpdate:modelValue":o[0]||(o[0]=m=>r.quantity=m),placeholder:t(a)("placeholder.quantity"),type:"number","style-type":"line"},null,8,["modelValue","placeholder"])]),_:1},8,["title"])]),e("div",mt,[I(D,{title:t(a)("create-nfr-form-items[0]"),width:224},{default:N(()=>[I(re,{modelValue:r.type,"onUpdate:modelValue":o[1]||(o[1]=m=>r.type=m),options:l,placeholder:t(a)("placeholder.type")},null,8,["modelValue","placeholder"])]),_:1},8,["title"])]),e("div",ft,[I(D,{title:t(a)("create-nfr-form-items[3]"),width:592},{default:N(()=>[I(Ie,{modelValue:r.desc,"onUpdate:modelValue":o[2]||(o[2]=m=>r.desc=m),max:80},null,8,["modelValue"])]),_:1},8,["title"])]),e("div",vt,[I(le,{title:t(a)("create-nfr-form-items[4]")},{default:N(()=>[I(M,{modelValue:r.details,"onUpdate:modelValue":o[3]||(o[3]=m=>r.details=m),placeholder:t(a)("placeholder.optional")},null,8,["modelValue","placeholder"])]),_:1},8,["title"])]),e("div",yt,[I(ie,{title:t(a)("create-nfr-form-items[5]")},{default:N(()=>[I(M,{modelValue:r.price,"onUpdate:modelValue":o[4]||(o[4]=m=>r.price=m),type:"number","style-type":"border"},null,8,["modelValue"])]),_:1},8,["title"])])]),e("div",gt,[e("div",ht,[e("img",{src:t(qe),alt:""},null,8,bt),e("span",null,v(n.data.name),1)]),e("div",Rt,[e("img",{src:n.data.avatar,alt:""},null,8,$t)])])]),e("div",kt,[e("div",{class:"item vice",onClick:g},[R(v(t(a)("back"))+" ",1),e("img",{src:t(ce),alt:""},null,8,It)]),e("div",{class:"item",onClick:u},[R(v(t(a)("request"))+" ",1),e("img",{src:t(de),alt:""},null,8,qt)])])])]),_:1},8,["visible"]))}});const xt=T(wt,[["__scopeId","data-v-6ee9ab17"]]),Nt=d=>(ye("data-v-e90b5f57"),d=d(),ge(),d),Ft={class:"explore-nft-details"},Lt=["src"],St=["src"],Bt={class:"nfrs"},Ct={class:"request"},Vt=Nt(()=>e("div",{style:{height:"89px"}},null,-1)),At=A({__name:"index",setup(d){const{t:s}=U(),n=O(),a=H(),{requestNFR:y}=G(),r=J(),l=w(),$=w(!1),_=w(!1),u=w(""),g=()=>{if(!a.currentUser.isLogin){a.setLoginModalVisible(!0);return}_.value=!0},p=async()=>{var q;const{address:h,id:i}=n.currentRoute.value.params,c=(await ee(String(h),String(i))).data;l.value={avatar:c.imageUrl,id:c.tokenId,contractAddress:c.contractAddress,name:c.name,props:(q=c.traits)==null?void 0:q.map(j=>{const{traitType:X,value:Z}=j;return`${X} ${Z}`}),owner:c.ownerAddressList}},o=ve(()=>{var i,b;const h=u.value;return!((b=(i=l.value)==null?void 0:i.owner)!=null&&b.every(c=>c.toLowerCase()!==h.toLowerCase()))}),m=async()=>{p(),u.value=a.currentUser.publicKey};P(()=>{m()});const k=async h=>{r.setGlobalLoading(!0);try{const i=await y(h),b=await Re(i);if(b.code!==0){S.error(b.msg),r.setGlobalLoading(!1);return}_.value=!1,$.value=!0,C.emit(B)}catch(i){console.error(i)}r.setGlobalLoading(!1)};return(h,i)=>(f(),x("div",null,[l.value?(f(),F(oe,{key:0,data:l.value},{default:N(()=>[e("div",Ft,[t(o)?(f(),x("div",{key:1,class:"btn",onClick:i[0]||(i[0]=b=>{var c,q;return t(n).push(`/create-nfr/${(c=l.value)==null?void 0:c.contractAddress}/${(q=l.value)==null?void 0:q.id}`)})},[R(v(t(s)("nfr-actions[1]"))+" ",1),e("img",{src:t(we),alt:""},null,8,St)])):(f(),x("div",{key:0,class:"btn",onClick:g},[R(v(t(s)("nfr-actions[0]"))+" ",1),e("img",{src:t(xe),alt:""},null,8,Lt)])),e("div",Bt,[l.value?(f(),F(ot,{key:0,data:l.value,"is-owner":t(o)},null,8,["data","is-owner"])):L("",!0)]),e("div",Ct,[l.value?(f(),F(Qe,{key:0,data:l.value,"is-owner":t(o)},null,8,["data","is-owner"])):L("",!0)])])]),_:1},8,["data"])):L("",!0),Vt,_.value?(f(),F(xt,{key:1,visible:_.value,data:l.value,onClose:i[1]||(i[1]=b=>_.value=!1),onRequest:k},null,8,["visible","data"])):L("",!0),$.value?(f(),F(ue,{key:2,visible:$.value,title:t(s)("alert-msg.request-success.title"),icon:t(Ne),onClose:i[2]||(i[2]=b=>$.value=!1)},{desc:N(()=>[R(v(t(s)("alert-msg.request-success.desc[0]"))+" ",1),e("a",null,v(t(s)("alert-msg.request-success.desc[1]")),1)]),_:1},8,["visible","title","icon"])):L("",!0)]))}});const Ht=T(At,[["__scopeId","data-v-e90b5f57"]]);export{Ht as default};
